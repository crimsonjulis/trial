<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sending Kisses...</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pacifico&family=Quicksand:wght@400;700&display=swap');

        :root {
            --bg-dark: #1a0b0f;
            --pink-light: #ff85a2;
            --pink-neon: #ff0055;
            --white-glow: rgba(255, 255, 255, 0.8);
        }

        body {
            margin: 0; padding: 0;
            height: 100vh;
            background: radial-gradient(circle, #2d1218, #000000);
            overflow: hidden;
            font-family: 'Quicksand', sans-serif;
            user-select: none;
            cursor: pointer; /* Suggests clicking */
            touch-action: manipulation; /* Improves touch response */
        }

        /* --- UI ELEMENTS --- */
        .ui-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 100;
            display: flex; flex-direction: column; align-items: center;
        }

        .title {
            margin-top: 20px;
            font-family: 'Pacifico', cursive;
            font-size: 1.8rem; color: var(--pink-light);
            text-shadow: 0 0 10px var(--pink-neon);
            opacity: 0.8;
            transition: transform 0.2s;
        }

        /* Progress Bar */
        .meter-container {
            width: 80%; max-width: 300px;
            height: 10px; background: rgba(255,255,255,0.1);
            border-radius: 20px; margin-top: 15px;
            overflow: hidden; border: 1px solid rgba(255, 0, 85, 0.3);
            position: relative;
        }

        .meter-fill {
            width: 0%; height: 100%;
            background: linear-gradient(90deg, #ff0055, #ff4d6d);
            box-shadow: 0 0 10px var(--pink-neon);
            transition: width 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .counter {
            font-size: 0.9rem; color: #fff; margin-top: 5px; opacity: 0.6;
        }

        /* --- THE KISS MARK --- */
        .kiss-mark {
            position: absolute;
            font-size: 3rem;
            transform: translate(-50%, -50%) scale(0);
            pointer-events: none;
            animation: kissPop 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
            filter: drop-shadow(0 0 15px var(--pink-neon));
            z-index: 10;
        }

        /* --- FINAL MESSAGE CARD --- */
        .final-card {
            position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%) scale(0.8);
            background: rgba(20, 10, 10, 0.95);
            border: 2px solid var(--pink-neon);
            padding: 30px; text-align: center;
            border-radius: 20px;
            box-shadow: 0 0 50px rgba(255, 0, 85, 0.4);
            opacity: 0; pointer-events: none;
            transition: all 0.5s ease;
            z-index: 200;
            backdrop-filter: blur(10px);
            width: 80%; max-width: 350px;
        }

        .final-card.show { opacity: 1; transform: translate(-50%, -50%) scale(1); pointer-events: auto; }
        
        .final-title { font-family: 'Pacifico'; font-size: 2.2rem; color: #ff4d6d; margin-bottom: 10px; }
        .final-text { color: #eee; line-height: 1.6; margin-bottom: 20px; font-size: 1rem; }

        /* --- ANIMATIONS --- */
        @keyframes kissPop {
            0% { transform: translate(-50%, -50%) scale(0) rotate(-10deg); opacity: 0; }
            50% { transform: translate(-50%, -50%) scale(1.2) rotate(10deg); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(1) rotate(0deg); opacity: 1; }
        }

        @keyframes floatUp {
            to { transform: translateY(-100px); opacity: 0; }
        }

        .pulse-text { animation: pulse 1s infinite alternate; }
        @keyframes pulse { from { transform: scale(1); } to { transform: scale(1.05); } }

    </style>
</head>
<body>

    <canvas id="particle-canvas"></canvas>

    <div class="ui-layer">
        <div class="title" id="main-title">Tap to send a Kiss</div>
        <div class="meter-container">
            <div class="meter-fill" id="meter"></div>
        </div>
        <div class="counter" id="count-text">0% Kisses Sent</div>
    </div>

    <div class="final-card" id="card">
        <div class="final-title">Happy Kiss Day üíã</div>
        <div class="final-text">
            1340km is a long way,<br>
            but my love travels instantly.<br><br>
            Sending you a million of these<br>
            until I can give you a real one.
        </div>
        <div style="font-size: 0.8rem; color: #aaa;">Irrespective of everything,<br>you are loved.</div>
    </div>

    <audio id="bg-music" loop>
        <source src="song.mp3" type="audio/mpeg">
    </audio>

    <script>
        // --- SETUP ---
        const meter = document.getElementById('meter');
        const countText = document.getElementById('count-text');
        const title = document.getElementById('main-title');
        const card = document.getElementById('card');
        const audio = document.getElementById('bg-music');
        
        let kissCount = 0;
        const targetKisses = 20; // Number of taps to win
        let completed = false;

        // --- INTERACTION ---
        document.body.addEventListener('mousedown', handleInput);
        document.body.addEventListener('touchstart', handleInput, {passive: false});

        function handleInput(e) {
            if(completed) return;
            
            // Prevent default touch behavior (zooming/scrolling)
            if(e.type === 'touchstart') e.preventDefault();

            // Start Audio on first interaction
            if(audio.paused) { audio.volume = 0.5; audio.play(); }

            // Get coordinates
            let x, y;
            if(e.type === 'touchstart') {
                x = e.touches[0].clientX;
                y = e.touches[0].clientY;
            } else {
                x = e.clientX;
                y = e.clientY;
            }

            // 1. Create Visual Kiss
            createKissMark(x, y);

            // 2. Spawn Particles (Your smooth logic)
            spawnParticles(x, y);

            // 3. Update Logic
            kissCount++;
            updateProgress();
        }

        function createKissMark(x, y) {
            const el = document.createElement('div');
            el.innerHTML = "üíã";
            el.className = 'kiss-mark';
            el.style.left = x + 'px';
            el.style.top = y + 'px';
            
            // Random rotation for realism
            const rot = Math.random() * 40 - 20;
            el.style.transform = `translate(-50%, -50%) rotate(${rot}deg)`;
            
            document.body.appendChild(el);

            // Remove after a while to keep DOM clean, but keep them long enough to fill screen
            setTimeout(() => {
                el.style.opacity = '0';
                setTimeout(() => el.remove(), 500);
            }, 3000);
        }

        function updateProgress() {
            const percentage = Math.min((kissCount / targetKisses) * 100, 100);
            meter.style.width = percentage + '%';
            countText.innerText = Math.floor(percentage) + '% Kisses Sent';

            // Dynamic Title
            if(percentage > 20) title.innerText = "Keep going! ‚ù§Ô∏è";
            if(percentage > 50) title.innerText = "Sending Love... üöÄ";
            if(percentage > 80) title.innerText = "Almost there! üåπ";

            if(kissCount >= targetKisses) {
                finish();
            }
        }

        function finish() {
            completed = true;
            title.innerText = "Delivery Complete! üíå";
            title.classList.add('pulse-text');
            
            // Explosion of particles
            for(let i=0; i<100; i++) {
                spawnParticles(window.innerWidth/2, window.innerHeight/2, true);
            }

            // Show Card
            setTimeout(() => {
                card.classList.add('show');
            }, 800);
        }

        // --- PARTICLE SYSTEM (Your smooth linear logic) ---
        const canvas = document.getElementById('particle-canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        let particles = [];

        class Particle {
            constructor(x, y, explosion = false) {
                this.x = x;
                this.y = y;
                this.size = Math.random() * 10 + 5;
                this.color = Math.random() > 0.5 ? "‚ù§Ô∏è" : "‚ú®";
                
                // Explosive vs Gentle
                const speed = explosion ? Math.random() * 10 + 5 : Math.random() * 5 + 2;
                const angle = Math.random() * Math.PI * 2;
                
                this.vx = Math.cos(angle) * speed;
                this.vy = Math.sin(angle) * speed;
                this.opacity = 1;
                this.decay = Math.random() * 0.02 + 0.01;
            }
            update() {
                this.x += this.vx;
                this.y += this.vy;
                this.opacity -= this.decay;
            }
            draw() {
                ctx.globalAlpha = this.opacity;
                ctx.font = `${this.size}px Arial`;
                ctx.fillText(this.color, this.x, this.y);
                ctx.globalAlpha = 1;
            }
        }

        function spawnParticles(x, y, explosion = false) {
            const count = explosion ? 5 : 3; // Particles per tap
            for(let i=0; i<count; i++) {
                particles.push(new Particle(x, y, explosion));
            }
        }

        function animate() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            for(let i=0; i<particles.length; i++) {
                particles[i].update();
                particles[i].draw();
                if(particles[i].opacity <= 0) {
                    particles.splice(i, 1);
                    i--;
                }
            }
            requestAnimationFrame(animate);
        }
        animate();

    </script>
</body>
</html>